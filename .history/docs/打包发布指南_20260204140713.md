# ClipLike 打包发布指南

> 2026.02.04 14:00:00

本文档介绍如何手动构建和打包 ClipLike 应用程序。

## 前置条件

- macOS 系统
- Xcode 14.0 或更高版本
- 有效的 Apple ID（用于签名，如果是本地测试可以使用自签名）

## 方法一：使用一键打包脚本（推荐）

我们在项目根目录提供了一个自动化脚本 `build_app.sh`，可以一键完成清理、归档和导出操作。

1. **打开终端**
   进入项目根目录：

   ```bash
   cd /path/to/ClipLike
   ```

2. **运行脚本**

   ```bash
   ./build_app.sh
   ```

   脚本会自动执行以下操作：
   - 清理旧的构建文件
   - 执行 `xcodebuild archive` 生成归档
   - 自动创建 `ExportOptions.plist`（默认使用 Development 签名，Team ID 已预设）
   - 导出 `.app` 文件到 `./build/Exported/` 目录
   - 自动打开导出目录

3. **获取应用**
   在弹出的 Finder 窗口中，你将看到 `ClipLike.app`，可以直接拖入应用程序文件夹使用。

## 方法二：使用 Xcode 图形界面打包

这是最直观的方法，适合大多数情况。

1. **打开项目**
   双击 `ClipLike.xcodeproj` 文件在 Xcode 中打开项目。

2. **选择目标设备**
   在 Xcode 顶部工具栏中，将运行目标设备选择为 **Any Mac (macOS)** 或 **My Mac**。

3. **配置签名**
   - 点击左侧导航栏的根节点 `ClipLike`。
   - 选择 `Signing & Capabilities` 选项卡。
   - 确保 `Team` 选择了你的开发团队（Personal Team 也可以）。
   - 确保 `Bundle Identifier` 是你期望的 ID（如 `com.henery.cliplike`）。

4. **执行归档 (Archive)**
   - 在菜单栏选择 **Product** > **Archive**。
   - Xcode 将开始编译项目。这可能需要几分钟。

5. **导出应用**
   - 编译完成后，会自动弹出 **Organizer** 窗口（如果没有，可以通过 **Window** > **Organizer** 打开）。
   - 在列表中选中刚刚生成的 Archive 记录。
   - 点击右侧的 **Distribute App** 按钮。
   - 选择分发方式：
     - **Copy App**: 直接复制 .app 文件（最快，适合本地使用）。
     - **TestFlight & App Store**: 上传到 App Store Connect。
     - **Direct Distribution**: 开发者 ID 签名分发。
     - **Development**: 开发测试分发。
   - 如果是自己使用，选择 **Copy App** 或 **Development** 即可。
   - 按照向导提示完成导出，最终你会得到一个 `ClipLike.app` 文件。

6. **运行**
   将导出的 `ClipLike.app` 拖入 `/Applications` 文件夹即可使用。

## 方法二：使用命令行 (xcodebuild)

如果你喜欢使用终端或需要自动化脚本，可以使用以下命令。

### 1. 清理并归档

```bash
xcodebuild archive \
  -project ClipLike.xcodeproj \
  -scheme ClipLike \
  -configuration Release \
  -archivePath ./build/ClipLike.xcarchive
```

### 2. 导出 .app

导出需要一个 `ExportOptions.plist` 文件。你可以先用 Xcode 手动导出一次，它会生成这个文件，保存下来供后续使用。或者创建一个最简单的：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>method</key>
    <string>development</string>
    <key>teamID</key>
    <string>YOUR_TEAM_ID</string>
</dict>
</plist>
```

然后运行导出命令：

```bash
xcodebuild -exportArchive \
  -archivePath ./build/ClipLike.xcarchive \
  -exportPath ./build/Exported \
  -exportOptionsPlist ./docs/ExportOptions.plist
```

## 注意事项

- **App Sandbox**: 本项目为了支持 Bob 翻译的 AppleScript 调用，在 Debug 和 Release 模式下均**禁用**了 App Sandbox。这意味着应用无法通过 Mac App Store 分发，只能通过 Direct Distribution 或 Development 方式分发。
- **权限**: 首次运行时，应用会请求“辅助功能”和“输入监控”权限，请确保在系统设置中允许。
